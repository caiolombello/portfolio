name: Discord Notification

on:
  push:
    paths:
      - "content/**"
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v40
        with:
          files: |
            content/**

      - name: Generate commit message
        id: commit-msg
        run: |
          CHANGED_FILES="${{ steps.changed-files.outputs.all_changed_files }}"
          COMMIT_MSG="ðŸ“¢ Content updated in portfolio\n\n"
          COMMIT_MSG+="Changed files:\n"
          for file in $CHANGED_FILES; do
            COMMIT_MSG+="â€¢ ${file}\n"
          done
          COMMIT_MSG+="By: ${{ github.actor }}\n"
          COMMIT_MSG+="View changes: ${{ github.event.head_commit.url }}"
          echo "message<<EOF" >> $GITHUB_ENV
          echo "$COMMIT_MSG" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Send Discord notification
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_USERNAME: "Portfolio Bot"
          DISCORD_AVATAR: "https://github.com/caiolombello.png"
        with:
          args: ${{ env.message }}
